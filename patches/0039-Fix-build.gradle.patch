From 1e8c333d60e32f5dce7fa0cbff56365f2cad1184 Mon Sep 17 00:00:00 2001
From: Sam Macbeth <sam@cliqz.com>
Date: Fri, 18 Sep 2020 16:28:50 +0200
Subject: Fix build.gradle

---
 app/build.gradle | 49 ++++--------------------------------------------
 bootstrap.sh     |  8 --------
 2 files changed, 4 insertions(+), 53 deletions(-)
 delete mode 100755 bootstrap.sh

diff --git a/app/build.gradle b/app/build.gradle
index 99a161ace..e726e0371 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -25,9 +25,7 @@ android {
         minSdkVersion Config.minSdkVersion
         targetSdkVersion Config.targetSdkVersion
         versionCode 1
-        /* Ghostery Begin: fixing version name in BuildConfig */
         versionName Config.generateDebugVersionName(project)
-        /* Ghostery End */
         vectorDrawables.useSupportLibrary = true
         testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
         testInstrumentationRunnerArguments clearPackageData: 'true'
@@ -58,12 +56,13 @@ android {
 
         if (gradle.hasProperty("localProperties.autosignReleaseWithDebugKey")) {
             signingConfig signingConfigs.debug
+        } else {
+            signingConfig signingConfigs.release
         }
 
         if (gradle.hasProperty("localProperties.debuggable")) {
             debuggable true
         }
-        signingConfig signingConfigs.release
     }
 
     buildTypes {
@@ -101,40 +100,6 @@ android {
             ]
         }
         release releaseTemplate >> {
-            buildConfigField "boolean", "USE_RELEASE_VERSIONING", "true"
-            applicationIdSuffix ".firefox"
-            def deepLinkSchemeValue = "fenix"
-            buildConfigField "String", "DEEP_LINK_SCHEME", "\"$deepLinkSchemeValue\""
-            manifestPlaceholders = [
-                    // This release type is meant to replace Firefox (Release channel) and therefore needs to inherit
-                    // its sharedUserId for all eternity. See:
-                    // https://searchfox.org/mozilla-central/search?q=moz_android_shared_id&case=false&regexp=false&path=
-                    // Shipping an app update without sharedUserId can have
-                    // fatal consequences. For example see:
-                    //  - https://issuetracker.google.com/issues/36924841
-                    //  - https://issuetracker.google.com/issues/36905922
-                    "sharedUserId": "org.mozilla.firefox.sharedID",
-                    "deepLinkScheme": deepLinkSchemeValue
-            ]
-        }
-        fennecNightly releaseTemplate >> {
-            buildConfigField "boolean", "USE_RELEASE_VERSIONING", "true"
-            applicationIdSuffix ".fennec_aurora"
-            def deepLinkSchemeValue = "fenix-nightly"
-            buildConfigField "String", "DEEP_LINK_SCHEME", "\"$deepLinkSchemeValue\""
-            manifestPlaceholders = [
-                    // This release type is meant to replace Firefox (Release channel) and therefore needs to inherit
-                    // its sharedUserId for all eternity. See:
-                    // https://searchfox.org/mozilla-central/search?q=moz_android_shared_id&case=false&regexp=false&path=
-                    // Shipping an app update without sharedUserId can have
-                    // fatal consequences. For example see:
-                    //  - https://issuetracker.google.com/issues/36924841
-                    //  - https://issuetracker.google.com/issues/36905922
-                    "sharedUserId": "org.mozilla.fennec.sharedID",
-                    "deepLinkScheme": deepLinkSchemeValue
-            ]
-        }
-        ghostery releaseTemplate >> {
             buildConfigField "boolean", "USE_RELEASE_VERSIONING", "true"
             applicationIdSuffix ".ghostery"
             def deepLinkSchemeValue = "ghostery"
@@ -147,7 +112,7 @@ android {
                     // fatal consequences. For example see:
                     //  - https://issuetracker.google.com/issues/36924841
                     //  - https://issuetracker.google.com/issues/36905922
-                    "sharedUserId": "com.ghostery.android.ghostery.sharedID",
+                    "sharedUserId": "org.mozilla.firefox.sharedID",
                     "deepLinkScheme": deepLinkSchemeValue
             ]
         }
@@ -162,9 +127,7 @@ android {
 
         // manifest.template.json is converted to manifest.json at build time.
         // No need to package the template in the APK.
-        // default ignoreAssetsPattern list includes all files and folders starting with _
-        // that breaks webextensions i18n as traslation are located in _locales folder
-        ignoreAssetsPattern "manifest.template.json:!.svn:!.git:!.ds_store:!*.scc:.*:!CVS:!thumbs.db:!picasa.ini:!*~"
+        ignoreAssetsPattern "manifest.template.json"
     }
 
     testOptions {
@@ -193,10 +156,6 @@ android {
             java.srcDirs = ['src/migration/java', 'src/geckoRelease/java']
             manifest.srcFile "src/migration/AndroidManifest.xml"
         }
-        ghostery {
-            java.srcDirs = ['src/migration/java']
-            manifest.srcFile "src/migration/AndroidManifest.xml"
-        }
     }
 
     splits {
diff --git a/bootstrap.sh b/bootstrap.sh
deleted file mode 100755
index f967dc344..000000000
--- a/bootstrap.sh
+++ /dev/null
@@ -1,8 +0,0 @@
-#!/bin/bash
-TAG="v8.5.2-4"
-EXT_DIR="app/src/main/assets/extensions/ghostery"
-DOWNLOAD_URL="https://cdncliqz.s3.amazonaws.com/update/fostery/ghostery-firefox-$TAG.zip"
-mkdir -p "$EXT_DIR"
-curl -L -o ghostery.zip "$DOWNLOAD_URL"
-unzip ghostery.zip -d "$EXT_DIR"
-rm ghostery.zip
-- 
2.28.0

