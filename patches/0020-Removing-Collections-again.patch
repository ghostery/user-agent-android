From c4a717f46f996c2f314903f06765e789b49a935d Mon Sep 17 00:00:00 2001
From: Stefano Pacifici <stefano.pacifici@gmail.com>
Date: Fri, 26 Jun 2020 16:18:32 +0200
Subject: Removing Collections (again)

---
 .../components/toolbar/DefaultToolbarMenu.kt  | 28 -------------------
 .../sessioncontrol/SessionControlAdapter.kt   | 19 -------------
 .../home/sessioncontrol/SessionControlView.kt | 28 ++-----------------
 .../fenix/tabstray/TabsTrayFragment.kt        |  1 -
 .../browser/SelectionBannerBinding.kt         |  4 ---
 .../main/res/layout/component_tabstray2.xml   |  2 +-
 .../res/layout/tabstray_multiselect_items.xml | 13 ---------
 7 files changed, 3 insertions(+), 92 deletions(-)

diff --git a/app/src/main/java/org/mozilla/fenix/components/toolbar/DefaultToolbarMenu.kt b/app/src/main/java/org/mozilla/fenix/components/toolbar/DefaultToolbarMenu.kt
index 0630e8fe2..6dfe58dca 100644
--- a/app/src/main/java/org/mozilla/fenix/components/toolbar/DefaultToolbarMenu.kt
+++ b/app/src/main/java/org/mozilla/fenix/components/toolbar/DefaultToolbarMenu.kt
@@ -214,10 +214,6 @@ open class DefaultToolbarMenu(
         onItemTapped.invoke(ToolbarMenu.Item.Downloads)
     }
 
-    val extensionsItem = WebExtensionPlaceholderMenuItem(
-        id = WebExtensionPlaceholderMenuItem.MAIN_EXTENSIONS_MENU_ID
-    )
-
     val findInPageItem = BrowserMenuImageText(
         label = context.getString(R.string.browser_menu_find_in_page),
         imageResource = R.drawable.mozac_ic_search,
@@ -279,14 +275,6 @@ open class DefaultToolbarMenu(
         onItemTapped.invoke(ToolbarMenu.Item.AddToTopSites)
     }
 
-    val saveToCollectionItem = BrowserMenuImageText(
-        label = context.getString(R.string.browser_menu_save_to_collection_2),
-        imageResource = R.drawable.ic_tab_collection,
-        iconTintColorResource = primaryTextColor()
-    ) {
-        onItemTapped.invoke(ToolbarMenu.Item.SaveToCollection)
-    }
-
     val settingsItem = BrowserMenuHighlightableItem(
         label = context.getString(R.string.browser_menu_settings),
         startImageResource = R.drawable.mozac_ic_settings,
@@ -331,19 +319,6 @@ open class DefaultToolbarMenu(
         onItemTapped.invoke(ToolbarMenu.Item.Quit)
     }
 
-    private fun getSyncItemTitle() =
-        accountManager.accountProfileEmail ?: context.getString(R.string.sync_menu_sign_in)
-
-    val syncMenuItem = BrowserMenuImageText(
-        getSyncItemTitle(),
-        R.drawable.ic_signed_out,
-        primaryTextColor()
-    ) {
-        onItemTapped.invoke(
-            ToolbarMenu.Item.SyncAccount(accountManager.accountState)
-        )
-    }
-
     @VisibleForTesting(otherwise = PRIVATE)
     val coreMenuItems by lazy {
         val menuItems =
@@ -354,8 +329,6 @@ open class DefaultToolbarMenu(
                 bookmarksItem,
                 historyItem,
                 downloadsItem,
-                extensionsItem,
-                syncMenuItem,
                 BrowserMenuDivider(),
                 getSetDefaultBrowserItem(),
                 getSetDefaultBrowserItem()?.let { BrowserMenuDivider() },
@@ -368,7 +341,6 @@ open class DefaultToolbarMenu(
                 addToHomeScreenItem.apply { visible = ::canAddToHomescreen },
                 installToHomescreen.apply { visible = ::canInstall },
                 addToTopSitesItem,
-                saveToCollectionItem,
                 BrowserMenuDivider(),
                 settingsItem,
                 if (shouldDeleteDataOnQuit) deleteDataOnQuit else null,
diff --git a/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlAdapter.kt b/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlAdapter.kt
index b321e2cce..a20e69a88 100644
--- a/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlAdapter.kt
+++ b/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlAdapter.kt
@@ -110,21 +110,6 @@ sealed class AdapterItem(@LayoutRes val viewType: Int) {
     object PrivateBrowsingDescription : AdapterItem(PrivateBrowsingDescriptionViewHolder.LAYOUT_ID)
     object NoCollectionsMessage : AdapterItem(NoCollectionsMessageViewHolder.LAYOUT_ID)
 
-    object CollectionHeader : AdapterItem(CollectionHeaderViewHolder.LAYOUT_ID)
-    data class CollectionItem(
-        val collection: TabCollection,
-        val expanded: Boolean
-    ) : AdapterItem(CollectionViewHolder.LAYOUT_ID) {
-        override fun sameAs(other: AdapterItem) =
-            other is CollectionItem && collection.id == other.collection.id
-
-        override fun contentsSameAs(other: AdapterItem): Boolean {
-            (other as? CollectionItem)?.let {
-                return it.expanded == this.expanded && it.collection.title == this.collection.title
-            } ?: return false
-        }
-    }
-
     data class TabInCollectionItem(
         val collection: TabCollection,
         val tab: ComponentTab,
@@ -338,10 +323,6 @@ class SessionControlAdapter(
             is TopSitePagerViewHolder -> {
                 holder.bind((item as AdapterItem.TopSitePager).topSites)
             }
-            is CollectionViewHolder -> {
-                val (collection, expanded) = item as AdapterItem.CollectionItem
-                holder.bindSession(collection, expanded)
-            }
             is TabInCollectionViewHolder -> {
                 val (collection, tab, isLastTab) = item as AdapterItem.TabInCollectionItem
                 holder.bindSession(collection, tab, isLastTab)
diff --git a/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlView.kt b/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlView.kt
index 59020b097..d255abd9e 100644
--- a/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlView.kt
+++ b/app/src/main/java/org/mozilla/fenix/home/sessioncontrol/SessionControlView.kt
@@ -28,7 +28,8 @@ import org.mozilla.fenix.utils.Settings
 
 // This method got a little complex with the addition of the tab tray feature flag
 // When we remove the tabs from the home screen this will get much simpler again.
-@Suppress("ComplexMethod", "LongParameterList")
+@Suppress("UNUSED_PARAMETER")
+@SuppressWarnings("UNUSED_PARAMETER", "ComplexMethod")
 @VisibleForTesting
 internal fun normalModeAdapterItems(
     topSites: List<TopSite>,
@@ -76,14 +77,6 @@ internal fun normalModeAdapterItems(
         items.add(AdapterItem.RecentVisitsItems)
     }
 
-    if (collections.isEmpty()) {
-        if (showCollectionsPlaceholder) {
-            items.add(AdapterItem.NoCollectionsMessage)
-        }
-    } else {
-        showCollections(collections, expandedCollections, items)
-    }
-
     if (pocketStories.isNotEmpty()) {
         shouldShowCustomizeHome = true
         items.add(AdapterItem.PocketStoriesItem)
@@ -98,23 +91,6 @@ internal fun normalModeAdapterItems(
     return items
 }
 
-private fun showCollections(
-    collections: List<TabCollection>,
-    expandedCollections: Set<Long>,
-    items: MutableList<AdapterItem>
-) {
-    // If the collection is expanded, we want to add all of its tabs beneath it in the adapter
-    items.add(AdapterItem.CollectionHeader)
-    collections.map {
-        AdapterItem.CollectionItem(it, expandedCollections.contains(it.id))
-    }.forEach {
-        items.add(it)
-        if (it.expanded) {
-            items.addAll(collectionTabItems(it.collection))
-        }
-    }
-}
-
 private fun privateModeAdapterItems() = listOf(AdapterItem.PrivateBrowsingDescription)
 
 private fun onboardingAdapterItems(onboardingState: OnboardingState): List<AdapterItem> {
diff --git a/app/src/main/java/org/mozilla/fenix/tabstray/TabsTrayFragment.kt b/app/src/main/java/org/mozilla/fenix/tabstray/TabsTrayFragment.kt
index 4987d8fbc..a5bc62e02 100644
--- a/app/src/main/java/org/mozilla/fenix/tabstray/TabsTrayFragment.kt
+++ b/app/src/main/java/org/mozilla/fenix/tabstray/TabsTrayFragment.kt
@@ -320,7 +320,6 @@ class TabsTrayFragment : AppCompatDialogFragment() {
                 containerView = view,
                 backgroundView = tabsTrayBinding.topBar,
                 showOnSelectViews = VisibilityModifier(
-                    tabsTrayMultiselectItemsBinding.collectMultiSelect,
                     tabsTrayMultiselectItemsBinding.shareMultiSelect,
                     tabsTrayMultiselectItemsBinding.menuMultiSelect,
                     tabsTrayBinding.multiselectTitle,
diff --git a/app/src/main/java/org/mozilla/fenix/tabstray/browser/SelectionBannerBinding.kt b/app/src/main/java/org/mozilla/fenix/tabstray/browser/SelectionBannerBinding.kt
index 93495b992..6a63e38af 100644
--- a/app/src/main/java/org/mozilla/fenix/tabstray/browser/SelectionBannerBinding.kt
+++ b/app/src/main/java/org/mozilla/fenix/tabstray/browser/SelectionBannerBinding.kt
@@ -96,10 +96,6 @@ class SelectionBannerBinding(
             navInteractor.onShareTabs(store.state.mode.selectedTabs)
         }
 
-        tabsTrayMultiselectItemsBinding.collectMultiSelect.setOnClickListener {
-            navInteractor.onSaveToCollections(store.state.mode.selectedTabs)
-        }
-
         binding.exitMultiSelect.setOnClickListener {
             store.dispatch(ExitSelectMode)
         }
diff --git a/app/src/main/res/layout/component_tabstray2.xml b/app/src/main/res/layout/component_tabstray2.xml
index 68e9d8251..5108d8213 100644
--- a/app/src/main/res/layout/component_tabstray2.xml
+++ b/app/src/main/res/layout/component_tabstray2.xml
@@ -65,7 +65,7 @@
         android:importantForAccessibility="no"
         app:fontFamily="@font/metropolis_semibold"
         app:layout_constraintBottom_toBottomOf="@id/topBar"
-        app:layout_constraintEnd_toStartOf="@id/collect_multi_select"
+        app:layout_constraintEnd_toStartOf="@id/share_multi_select"
         app:layout_constraintHorizontal_bias="0.0"
         app:layout_constraintHorizontal_chainStyle="packed"
         app:layout_constraintStart_toEndOf="@+id/exit_multi_select"
diff --git a/app/src/main/res/layout/tabstray_multiselect_items.xml b/app/src/main/res/layout/tabstray_multiselect_items.xml
index 22d325a1a..1c395f65e 100644
--- a/app/src/main/res/layout/tabstray_multiselect_items.xml
+++ b/app/src/main/res/layout/tabstray_multiselect_items.xml
@@ -9,19 +9,6 @@
     android:layout_height="wrap_content"
     tools:parentTag="androidx.constraintlayout.widget.ConstraintLayout">
 
-    <ImageButton
-        android:id="@+id/collect_multi_select"
-        android:layout_width="48dp"
-        android:layout_height="48dp"
-        android:background="?android:attr/selectableItemBackgroundBorderless"
-        android:contentDescription="@string/tab_tray_collection_button_multiselect_content_description"
-        android:visibility="gone"
-        app:layout_constraintBottom_toBottomOf="@id/topBar"
-        app:layout_constraintEnd_toStartOf="@id/share_multi_select"
-        app:layout_constraintTop_toTopOf="@id/topBar"
-        app:srcCompat="@drawable/ic_tab_collection"
-        app:tint="@color/contrast_text_normal_theme" />
-
     <ImageButton
         android:id="@+id/share_multi_select"
         android:layout_width="48dp"
-- 
2.34.1

