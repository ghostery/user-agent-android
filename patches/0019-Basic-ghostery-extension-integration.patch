From dbda7e1be89ca64b630b3814f96fd59d01a4d40e Mon Sep 17 00:00:00 2001
From: Sam Macbeth <sam@cliqz.com>
Date: Mon, 3 Aug 2020 18:31:14 +0200
Subject: Basic ghostery extension integration

---
 app/build.gradle                                       | 4 +++-
 app/src/main/java/org/mozilla/fenix/components/Core.kt | 8 ++++++++
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/app/build.gradle b/app/build.gradle
index 93ba55042..258316712 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -179,7 +179,9 @@ android {
 
         // manifest.template.json is converted to manifest.json at build time.
         // No need to package the template in the APK.
-        ignoreAssetsPattern "manifest.template.json"
+        // default ignoreAssetsPattern list includes all files and folders starting with _
+        // that breaks webextensions i18n as traslation are located in _locales folder
+        ignoreAssetsPattern "manifest.template.json:!.svn:!.git:!.ds_store:!*.scc:.*:!CVS:!thumbs.db:!picasa.ini:!*~"
     }
 
     testOptions {
diff --git a/app/src/main/java/org/mozilla/fenix/components/Core.kt b/app/src/main/java/org/mozilla/fenix/components/Core.kt
index 3db6d32c2..0f2b8d1ad 100644
--- a/app/src/main/java/org/mozilla/fenix/components/Core.kt
+++ b/app/src/main/java/org/mozilla/fenix/components/Core.kt
@@ -159,6 +159,14 @@ class Core(
                 onError = { ext, throwable ->
                     Log.e("GHOSTERY", "Failed to install Ghostery Search webextension: $ext", throwable)
                 })
+
+            it.installWebExtension("Ghostery", "resource://android/assets/extensions/ghostery/",
+                onSuccess = {
+                    Log.d("GHOSTERY", "Installed Ghostery webextension: ${it.id}")
+                },
+                onError = { ext, throwable ->
+                    Log.e("GHOSTERY", "Failed to install Ghostery webextension: $ext", throwable)
+                })
         }
     }
 
-- 
2.37.2

