From da76aa8aa7083ccbdbbf3179815b70277da568fe Mon Sep 17 00:00:00 2001
From: Stefano Pacifici <stefano.pacifici@gmail.com>
Date: Wed, 15 Jul 2020 16:11:33 +0200
Subject: Ghostery splashscreen

---
 fenix/app/build.gradle                                    | 1 +
 fenix/app/src/main/AndroidManifest.xml                    | 1 +
 fenix/app/src/main/java/org/mozilla/fenix/HomeActivity.kt | 3 +++
 fenix/app/src/main/res/values/styles.xml                  | 6 ++++++
 fenix/buildSrc/src/main/java/FenixDependencies.kt         | 2 ++
 5 files changed, 13 insertions(+)

diff --git a/fenix/app/build.gradle b/fenix/app/build.gradle
index cd18be708b..992e5ee619 100644
--- a/fenix/app/build.gradle
+++ b/fenix/app/build.gradle
@@ -625,6 +625,7 @@ dependencies {
     implementation FenixDependencies.androidx_lifecycle_viewmodel
     implementation FenixDependencies.androidx_core
     implementation FenixDependencies.androidx_core_ktx
+    implementation FenixDependencies.androidx_core_splashscreen
     implementation FenixDependencies.androidx_transition
     implementation FenixDependencies.androidx_work_ktx
     implementation FenixDependencies.androidx_datastore
diff --git a/fenix/app/src/main/AndroidManifest.xml b/fenix/app/src/main/AndroidManifest.xml
index a9d41ec477..9b3557f7fc 100644
--- a/fenix/app/src/main/AndroidManifest.xml
+++ b/fenix/app/src/main/AndroidManifest.xml
@@ -101,6 +101,7 @@
             android:name=".HomeActivity"
             android:exported="true"
             android:configChanges="keyboard|keyboardHidden|mcc|mnc|orientation|screenSize|layoutDirection|smallestScreenSize|screenLayout"
+            android:theme="@style/Theme.App.Starting"
             android:launchMode="singleTask"
             android:resizeableActivity="true"
             android:supportsPictureInPicture="true"
diff --git a/fenix/app/src/main/java/org/mozilla/fenix/HomeActivity.kt b/fenix/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
index 5d1724eebb..17c5a51fea 100644
--- a/fenix/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
+++ b/fenix/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
@@ -33,6 +33,7 @@ import androidx.annotation.VisibleForTesting.Companion.PROTECTED
 import androidx.appcompat.app.ActionBar
 import androidx.appcompat.widget.Toolbar
 import androidx.core.app.NotificationManagerCompat
+import androidx.core.splashscreen.SplashScreen.Companion.installSplashScreen
 import androidx.lifecycle.lifecycleScope
 import androidx.navigation.NavDestination
 import androidx.navigation.NavDirections
@@ -253,6 +254,8 @@ open class HomeActivity : LocaleAwareAppCompatActivity(), NavHostActivity {
 
         components.publicSuffixList.prefetch()
 
+        installSplashScreen()
+
         // Changing a language on the Language screen restarts the activity, but the activity keeps
         // the old layout direction. We have to update the direction manually.
         window.decorView.layoutDirection = TextUtils.getLayoutDirectionFromLocale(Locale.getDefault())
diff --git a/fenix/app/src/main/res/values/styles.xml b/fenix/app/src/main/res/values/styles.xml
index 19eaa6d166..cafcb06a48 100644
--- a/fenix/app/src/main/res/values/styles.xml
+++ b/fenix/app/src/main/res/values/styles.xml
@@ -130,6 +130,12 @@
         <item name="tabCounterTintColor">?attr/textPrimary</item>
     </style>
 
+    <style name="Theme.App.Starting" parent="Theme.SplashScreen">
+        <item name="windowSplashScreenAnimatedIcon">@drawable/ic_launcher_foreground</item>
+        <item name="windowSplashScreenBackground">#202225</item>
+        <item name="postSplashScreenTheme">@style/NormalTheme</item>
+    </style>
+
     <!-- A theme derived from the normal activity theme, but to look and behave like a dialog -->
     <style name="DialogActivityTheme" parent="NormalTheme">
         <item name="android:windowElevation">16dp</item>
diff --git a/fenix/buildSrc/src/main/java/FenixDependencies.kt b/fenix/buildSrc/src/main/java/FenixDependencies.kt
index f142f33a9a..f4a5b7a954 100644
--- a/fenix/buildSrc/src/main/java/FenixDependencies.kt
+++ b/fenix/buildSrc/src/main/java/FenixDependencies.kt
@@ -41,6 +41,7 @@ object FenixVersions {
     const val androidx_lifecycle = "2.6.1"
     const val androidx_fragment = "1.5.7"
     const val androidx_navigation = "2.5.3"
+    const val androidx_splash_screen = "1.0.1"
     const val androidx_recyclerview = "1.3.0"
     const val androidx_core = "1.10.1"
     const val androidx_paging = "3.1.1"
@@ -95,6 +96,7 @@ object FenixDependencies {
     const val androidx_annotation = "androidx.annotation:annotation:${FenixVersions.androidx_annotation}"
     const val androidx_benchmark_junit4 = "androidx.benchmark:benchmark-junit4:${FenixVersions.androidx_benchmark}"
     const val androidx_benchmark_macro_junit4 = "androidx.benchmark:benchmark-macro-junit4:${FenixVersions.androidx_benchmark}"
+    const val androidx_core_splashscreen = "androidx.core:core-splashscreen:${FenixVersions.androidx_splash_screen}"
     const val androidx_profileinstaller = "androidx.profileinstaller:profileinstaller:${FenixVersions.androidx_profileinstaller}"
     const val androidx_biometric = "androidx.biometric:biometric:${FenixVersions.androidx_biometric}"
     const val androidx_fragment = "androidx.fragment:fragment-ktx:${FenixVersions.androidx_fragment}"
-- 
2.39.2 (Apple Git-143)

