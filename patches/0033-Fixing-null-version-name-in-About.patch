From f1220ff9c216d55b955ce8f48f05c154af9794b0 Mon Sep 17 00:00:00 2001
From: Krzysztof Modras <chrmod@chrmod.net>
Date: Thu, 17 Mar 2022 16:25:43 +0100
Subject: Fixing null version name in About

---
 app/build.gradle                                              | 2 +-
 .../java/org/mozilla/fenix/settings/about/AboutFragment.kt    | 2 +-
 buildSrc/src/main/java/Config.kt                              | 4 ++--
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/app/build.gradle b/app/build.gradle
index 862979a96..77d500cb3 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -38,7 +38,7 @@ android {
         minSdkVersion Config.minSdkVersion
         targetSdkVersion Config.targetSdkVersion
         versionCode 1
-        versionName Config.generateDebugVersionName()
+        versionName Config.generateDebugVersionName(project)
         vectorDrawables.useSupportLibrary = true
         testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
         testInstrumentationRunnerArguments clearPackageData: 'true'
diff --git a/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt b/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
index 3097fd718..b7fea43bd 100644
--- a/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
+++ b/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
@@ -114,7 +114,7 @@ class AboutFragment : Fragment(), AboutPageListener {
 
             String.format(
                 "%s (Build #%s)%s\n%s: %s\n%s: %s\n%s: %s",
-                packageInfo.versionName,
+                BuildConfig.VERSION_NAME,
                 versionCode,
                 maybeFenixGitHash,
                 componentsAbbreviation,
diff --git a/buildSrc/src/main/java/Config.kt b/buildSrc/src/main/java/Config.kt
index ed6f95683..f5ab641b0 100644
--- a/buildSrc/src/main/java/Config.kt
+++ b/buildSrc/src/main/java/Config.kt
@@ -16,13 +16,13 @@ object Config {
     const val targetSdkVersion = 30
 
     @JvmStatic
-    private fun generateDebugVersionName(): String {
+    private fun generateDebugVersionName(project: Project): String {
         val today = Date()
         // Append the year (2 digits) and week in year (2 digits). This will make it easier to distinguish versions and
         // identify ancient versions when debugging issues. However this will still keep the same version number during
         // the week so that we do not end up with a lot of versions in tools like Sentry. As an extra this matches the
         // sections we use in the changelog (weeks).
-        return SimpleDateFormat("1.0.yyww", Locale.US).format(today)
+        return if (project.hasProperty("versionName")) project.property("versionName") as String else SimpleDateFormat("1.0.yyww", Locale.US).format(today)
     }
 
     @JvmStatic
-- 
2.35.1

