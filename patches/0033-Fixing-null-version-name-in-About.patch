From b9d863c225614b0db2f1353777b501073b6b5d3a Mon Sep 17 00:00:00 2001
From: Krzysztof Modras <chrmod@chrmod.net>
Date: Thu, 17 Mar 2022 16:25:43 +0100
Subject: Fixing null version name in About

---
 app/build.gradle                                              | 2 +-
 .../java/org/mozilla/fenix/settings/about/AboutFragment.kt    | 2 +-
 buildSrc/src/main/java/Config.kt                              | 4 ++--
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/fenix/app/build.gradle b/fenix/app/build.gradle
index b3a49f871..7cb97d49d 100644
--- a/fenix/app/build.gradle
+++ b/fenix/app/build.gradle
@@ -38,7 +38,7 @@ android {
         minSdkVersion Config.minSdkVersion
         targetSdkVersion Config.targetSdkVersion
         versionCode 1
-        versionName Config.generateDebugVersionName()
+        versionName Config.generateDebugVersionName(project)
         vectorDrawables.useSupportLibrary = true
         testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
         testInstrumentationRunnerArguments clearPackageData: 'true'
diff --git a/fenix/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt b/fenix/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
index b9cf2bc5f..928c1a900 100644
--- a/fenix/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
+++ b/fenix/app/src/main/java/org/mozilla/fenix/settings/about/AboutFragment.kt
@@ -108,7 +108,7 @@ class AboutFragment : Fragment(), AboutPageListener {

             String.format(
                 "%s (Build #%s)%s\n%s: %s\n%s: %s",
-                packageInfo.versionName,
+                BuildConfig.VERSION_NAME,
                 versionCode,
                 maybeFenixGitHash,
                 maybeGecko,
diff --git a/buildSrc/src/main/java/Config.kt b/buildSrc/src/main/java/Config.kt
index cbcdefd9e..beb199073 100644
--- a/fenix/buildSrc/src/main/java/Config.kt
+++ b/fenix/buildSrc/src/main/java/Config.kt
@@ -17,13 +17,13 @@ object Config {
     const val targetSdkVersion = 33

     @JvmStatic
-    private fun generateDebugVersionName(): String {
+    private fun generateDebugVersionName(project: Project): String {
         val today = Date()
         // Append the year (2 digits) and week in year (2 digits). This will make it easier to distinguish versions and
         // identify ancient versions when debugging issues. However this will still keep the same version number during
         // the week so that we do not end up with a lot of versions in tools like Sentry. As an extra this matches the
         // sections we use in the changelog (weeks).
-        return SimpleDateFormat("1.0.yyww", Locale.US).format(today)
+        return if (project.hasProperty("versionName")) project.property("versionName") as String else SimpleDateFormat("1.0.yyww", Locale.US).format(today)
     }

     @JvmStatic
--
2.37.2

