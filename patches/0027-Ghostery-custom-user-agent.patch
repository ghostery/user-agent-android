From 468b4aca3315dd361ead3e837f005f72bda454ad Mon Sep 17 00:00:00 2001
From: Stefano Pacifici <stefano.pacifici@gmail.com>
Date: Wed, 29 Jul 2020 19:08:26 +0200
Subject: Ghostery custom user agent

---
 app/src/main/java/org/mozilla/fenix/components/Core.kt | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/app/src/main/java/org/mozilla/fenix/components/Core.kt b/app/src/main/java/org/mozilla/fenix/components/Core.kt
index 1fd0c992e..fd4542120 100644
--- a/app/src/main/java/org/mozilla/fenix/components/Core.kt
+++ b/app/src/main/java/org/mozilla/fenix/components/Core.kt
@@ -90,6 +90,7 @@ import org.mozilla.fenix.tabstray.SearchTermTabGroupMiddleware
 import org.mozilla.fenix.telemetry.TelemetryMiddleware
 import org.mozilla.fenix.utils.getUndoDelay
 import org.mozilla.geckoview.GeckoRuntime
+import org.mozilla.geckoview.GeckoSession
 import java.util.concurrent.TimeUnit
 
 /**
@@ -107,6 +108,7 @@ class Core(
      */
     val engine: Engine by lazyMonitored {
         val defaultSettings = DefaultSettings(
+            userAgentString = customUserAgent,
             requestInterceptor = requestInterceptor,
             remoteDebuggingEnabled = context.settings().isRemoteDebuggingEnabled &&
                 Build.VERSION.SDK_INT >= Build.VERSION_CODES.M,
@@ -161,6 +163,12 @@ class Core(
         }
     }
 
+    val customUserAgent by lazyMonitored {
+        val defaultUserAgent = GeckoSession.getDefaultUserAgent()
+        val (prefix, postfix) = defaultUserAgent.split(')')
+        "$prefix; Ghostery:3.0)$postfix"
+    }
+
     /**
      * Passed to [engine] to intercept requests for app links,
      * and various features triggered by page load requests.
-- 
2.35.1

